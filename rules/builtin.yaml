version: "1.0"
rules:
  # Line count checks
  - code: CD001
    description: File length is excessive
    severity: error
    category: length
    dimension: correctness
    primaryOnly: true
    matchSpec:
      metric: lineCount
      action: greaterThan
      value: 300
    errorMessage: "File has more than 300 lines"
    suggestion: "Extract task-specific content to separate docs and use progressive disclosure"
    links:
      - "https://www.humanlayer.dev/blog/writing-a-good-claude-md"

  - code: CD002
    description: File length is high
    severity: warning
    category: length
    dimension: correctness
    primaryOnly: true
    matchSpec:
      metric: lineCount
      action: greaterThan
      value: 100
    errorMessage: "File has more than 100 lines"
    suggestion: "Consider being more concise. Ideal CLAUDE.md is ~60 lines"

  # Instruction count checks
  - code: CD003
    description: Too many instructions
    severity: error
    category: instructions
    dimension: correctness
    primaryOnly: true
    matchSpec:
      metric: instructionCount
      action: greaterThan
      value: 100
    errorMessage: "Too many instructions (>100 detected, +50 from Claude Code)"
    suggestion: "LLMs reliably follow 150-200 instructions. Reduce instruction count"

  - code: CD004
    description: High instruction count
    severity: warning
    category: instructions
    dimension: correctness
    primaryOnly: true
    matchSpec:
      metric: instructionCount
      action: greaterThan
      value: 50
    errorMessage: "High instruction count (~50+ detected, +50 from Claude Code = ~100+)"
    suggestion: "Consider reducing instructions to improve compliance"

  # Linter abuse detection
  - code: CD010
    description: Indentation rules detected
    severity: warning
    category: linter-abuse
    dimension: style
    matchSpec:
      action: regexMatch
      patterns:
        - "indent(ation)?\\s*(with|using)?\\s*\\d+\\s*(spaces?|tabs?)"
    errorMessage: "Indentation rules found"
    suggestion: "Use a code formatter instead of Claude for indentation rules"

  - code: CD011
    description: Line length rules detected
    severity: warning
    category: linter-abuse
    dimension: style
    matchSpec:
      action: regexMatch
      patterns:
        - "(max|maximum)\\s*(line)?\\s*(length|width)"
    errorMessage: "Line length rules found"
    suggestion: "Use a linter for line length enforcement"

  - code: CD012
    description: Quote style rules detected
    severity: warning
    category: linter-abuse
    dimension: style
    matchSpec:
      action: regexMatch
      patterns:
        - "(single|double)\\s*quotes?"
        - "use\\s+(single|double)\\s+quotes"
    errorMessage: "Quote style rules found"
    suggestion: "Use a formatter (Prettier, Biome) for quote style"

  - code: CD013
    description: Naming convention rules detected
    severity: warning
    category: linter-abuse
    dimension: style
    matchSpec:
      action: regexMatch
      patterns:
        - "naming\\s*convention"
        - "use\\s+camelCase"
        - "use\\s+snake_case"
        - "use\\s+PascalCase"
    errorMessage: "Naming convention rules found"
    suggestion: "Use a linter for naming conventions"

  - code: CD014
    description: Semicolon rules detected
    severity: warning
    category: linter-abuse
    dimension: style
    matchSpec:
      action: regexMatch
      patterns:
        - "(always|never)\\s*(use)?\\s*semicolons?"
    errorMessage: "Semicolon rules found"
    suggestion: "Use a formatter for semicolon style"

  - code: CD015
    description: Trailing character rules detected
    severity: warning
    category: linter-abuse
    dimension: style
    matchSpec:
      action: regexMatch
      patterns:
        - "trailing\\s*(comma|whitespace|space)"
    errorMessage: "Trailing character rules found"
    suggestion: "Use a formatter for trailing characters"

  # Auto-generated content detection
  - code: CD020
    description: Auto-generated marker detected
    severity: warning
    category: auto-generated
    dimension: compliance
    primaryOnly: true
    matchSpec:
      action: regexMatch
      patterns:
        - "generated\\s*(by|with|using)"
        - "auto-?generated"
        - "this\\s+file\\s+was\\s+(created|generated)"
    errorMessage: "File appears to be auto-generated"
    suggestion: "CLAUDE.md is high-leverage. Carefully craft each line manually instead of using /init"

  - code: CD021
    description: Init command reference detected
    severity: info
    category: auto-generated
    dimension: compliance
    primaryOnly: true
    matchSpec:
      action: regexMatch
      patterns:
        - "/init"
        - "claude\\s+code\\s+initialized"
    errorMessage: "References to /init command found"
    suggestion: "Avoid using /init. Manually craft your CLAUDE.md for best results"

  # Progressive disclosure checks
  - code: CD030
    description: No progressive disclosure
    severity: info
    category: progressive-disclosure
    dimension: style
    primaryOnly: true
    matchSpec:
      action: and
      subMatch:
        - metric: lineCount
          action: greaterThan
          value: 60
        - action: regexNotMatch
          patterns:
            - "see\\s+[\\w/.-]+\\.md"
            - "refer\\s+to\\s+[\\w/.-]+\\.md"
            - "read\\s+[\\w/.-]+\\.md"
            - "docs?/[\\w/.-]+\\.md"
            - "check\\s+[\\w/.-]+\\.md"
    errorMessage: "No progressive disclosure detected in a file over 60 lines"
    suggestion: "Point to separate docs for task-specific information instead of including everything"

  # Good practices detection (positive signals)
  - code: CD040
    description: Good progressive disclosure
    severity: info
    category: good-practice
    dimension: style
    primaryOnly: true
    matchSpec:
      action: regexMatch
      patterns:
        - "see\\s+[\\w/.-]+\\.md"
        - "refer\\s+to\\s+[\\w/.-]+\\.md"
        - "docs?/[\\w/.-]+\\.md"
        - "for\\s+.*\\s+see\\s+"
    errorMessage: "Progressive disclosure pattern detected"
    suggestion: ""

  # Generic advice detection
  - code: CD050
    description: Generic advice detected
    severity: warning
    category: generic-advice
    dimension: style
    primaryOnly: true
    matchSpec:
      action: regexMatch
      patterns:
        - "write\\s+clean\\s+code"
        - "follow\\s+best\\s+practices"
        - "format\\s+(code\\s+)?properly"
        - "use\\s+meaningful\\s+(variable\\s+)?names"
        - "keep\\s+(code|it)\\s+simple"
        - "write\\s+readable\\s+code"
    errorMessage: "Generic advice found that applies to any project"
    suggestion: "Replace generic advice with project-specific instructions and concrete examples"
    links:
      - "https://www.builder.io/blog/claude-md-guide"

  # Missing project context
  - code: CD051
    description: Missing project context
    severity: info
    category: content-quality
    dimension: compliance
    primaryOnly: true
    matchSpec:
      action: regexNotMatch
      patterns:
        - "^#\\s+.+"
        - "this\\s+(project|repo|repository)"
        - "purpose"
        - "overview"
    errorMessage: "No project description or context found"
    suggestion: "Start with what the project is, not how to set it up. Add a brief project overview"
    links:
      - "https://www.builder.io/blog/claude-md-guide"

  # Missing build/test commands
  - code: CD052
    description: Missing build commands
    severity: info
    category: content-quality
    dimension: compliance
    primaryOnly: true
    matchSpec:
      action: regexNotMatch
      patterns:
        - "(npm|yarn|pnpm|bun)\\s+(run\\s+)?(test|build|lint)"
        - "make\\s+(build|test|lint)"
        - "go\\s+(build|test)"
        - "cargo\\s+(build|test)"
        - "pytest"
        - "mvn\\s+(test|compile)"
        - "gradle\\s+(build|test)"
    errorMessage: "No build/test/lint commands found"
    suggestion: "Include commands Claude needs to verify changes (test, build, lint)"
    links:
      - "https://www.builder.io/blog/claude-md-guide"

  # No negative instructions
  - code: CD053
    description: No negative instructions
    severity: info
    category: content-quality
    dimension: compliance
    primaryOnly: true
    matchSpec:
      action: and
      subMatch:
        - metric: lineCount
          action: greaterThan
          value: 30
        - action: regexNotMatch
          patterns:
            - "\\bdon'?t\\b"
            - "\\bavoid\\b"
            - "\\bnever\\b"
            - "\\bdo\\s+not\\b"
    errorMessage: "No negative instructions found in a file over 30 lines"
    suggestion: "Specify what NOT to do, not just what to do. Negative instructions improve results"
    links:
      - "https://www.builder.io/blog/claude-md-guide"

  # No code examples
  - code: CD054
    description: No code examples
    severity: info
    category: content-quality
    dimension: compliance
    primaryOnly: true
    matchSpec:
      action: and
      subMatch:
        - metric: lineCount
          action: greaterThan
          value: 50
        - action: regexNotMatch
          patterns:
            - "```"
    errorMessage: "No code examples found in a file over 50 lines"
    suggestion: "Add concrete code examples. Examples trump abstract rules for style preferences"
    links:
      - "https://www.builder.io/blog/claude-md-guide"

  # Good practice: Has negative instructions
  - code: CD041
    description: Good negative instructions
    severity: info
    category: good-practice
    dimension: compliance
    primaryOnly: true
    matchSpec:
      action: regexMatch
      patterns:
        - "\\bdon'?t\\b"
        - "\\bavoid\\b"
        - "\\bnever\\b"
        - "\\bdo\\s+not\\b"
    errorMessage: "Negative instructions detected (what NOT to do)"
    suggestion: ""

  # Good practice: Has code examples
  - code: CD042
    description: Good code examples
    severity: info
    category: good-practice
    dimension: style
    primaryOnly: true
    matchSpec:
      action: regexMatch
      patterns:
        - "```"
    errorMessage: "Code examples detected"
    suggestion: ""

  # Referenced documentation checks
  - code: CD031
    description: Referenced documentation file not found
    severity: error
    category: referenced-docs
    dimension: correctness
    primaryOnly: true
    matchSpec:
      metric: broken_references_count
      action: greaterThan
      value: 0
    errorMessage: "One or more referenced documentation files do not exist"
    suggestion: "Remove broken references or create the missing files"

  - code: CD032
    description: Referenced documentation file is stale
    severity: warning
    category: referenced-docs
    dimension: correctness
    primaryOnly: true
    matchSpec:
      metric: stale_references_count
      action: greaterThan
      value: 0
    errorMessage: "Referenced docs haven't been updated in a long time"
    suggestion: "Review and update stale documentation or remove outdated references"

  - code: CD033
    description: Total instruction count across all context files is too high
    severity: warning
    category: referenced-docs
    dimension: compliance
    primaryOnly: true
    matchSpec:
      metric: total_instruction_count
      action: greaterThan
      value: 200
    errorMessage: "Combined instruction count across all context files exceeds 200"
    suggestion: "Trim instructions â€” total volume across all files affects LLM performance"

  # Staleness detection
  - code: CD055
    description: CLAUDE.md is stale relative to repo activity in its scope
    severity: warning
    category: staleness
    dimension: freshness
    primaryOnly: true
    matchSpec:
      action: and
      subMatch:
        - metric: claude_md_days_since_update
          action: greaterThan
          value: 90
        - metric: scope_commits_since_update
          action: greaterThan
          value: 0
    errorMessage: "CLAUDE.md hasn't been updated but its directory scope has active commits"
    suggestion: "Review and update CLAUDE.md to reflect recent code changes in its scope"

  # Cross-file consistency checks
  - code: CD034
    description: Duplicated instructions across context files
    severity: warning
    category: cross-file-consistency
    dimension: compliance
    primaryOnly: true
    matchSpec:
      metric: duplicate_instruction_count
      action: greaterThan
      value: 0
    errorMessage: "Same instructions found in multiple context files"
    suggestion: "Keep each instruction in one place to avoid confusion and wasted context"
